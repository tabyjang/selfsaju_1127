import json
import re
import random

# 02_갑인.json - 봄날 호랑이와 함께하는 거목
# 특성: 용맹함, 추진력, 개척정신, 정의감, 직진

# 갑인 일주에 맞는 120개의 구체적인 액션
actions_02 = {
    "장생": {
        1: "중요한 의견이 있다면 오늘 거침없이 말하세요. 주저하지 말고 당당하게 목소리를 내세요.",
        2: "아무도 시도하지 않은 새로운 방법을 하나 시도해보세요. 첫 번째가 되는 걸 두려워하지 마세요.",
        3: "배우고 싶었던 것을 오늘 시작하세요. 첫 강의를 듣거나 첫 페이지를 펼치세요.",
        4: "먼저 인사를 건네세요. 당신이 먼저 다가가면 분위기가 달라집니다.",
        5: "누군가의 눈을 똑바로 바라보며 진심을 전하세요. 당신의 진정성이 전해질 거예요.",
        6: "오래된 친구나 지인에게 먼저 연락하세요. 관계의 뿌리를 다시 단단히 하세요.",
        7: "이루고 싶은 목표를 종이에 적으세요. 구체적으로, 명확하게 적으세요.",
        8: "오늘 자신감 있게 행동하세요. 걸음걸이부터 목소리까지, 당당하게 하세요.",
        9: "평소보다 일찍 일어나 하루를 먼저 시작하세요. 선두에 서는 기분을 느껴보세요.",
        10: "미루던 중요한 일에 바로 착수하세요. 생각을 줄이고 행동을 늘리세요."
    },
    "목욕": {
        1: "옷장이나 책상을 정리하세요. 낡은 것을 버리고 새로운 공간을 만드세요.",
        2: "샤워하면서 복잡한 생각을 흘려보내세요. 물과 함께 걱정도 흘려보내세요.",
        3: "평소와 다른 스타일을 시도하세요. 새로운 옷차림이나 헤어스타일을 시도해보세요.",
        4: "오래된 습관 하나를 고치세요. 새로운 방식으로 하루를 시작하세요.",
        5: "안 읽는 책, 안 쓰는 물건을 정리하세요. 공간을 비우면 새것이 들어옵니다.",
        6: "씻고 정돈하세요. 몸과 마음, 공간을 깨끗하게 하세요.",
        7: "낡은 생각을 버리세요. 새로운 관점으로 상황을 다시 보세요.",
        8: "과거의 실수를 용서하세요. 자신에게도, 남에게도 새 출발의 기회를 주세요.",
        9: "불필요한 약속이나 관계를 정리하세요. 진짜 중요한 것에 집중하세요.",
        10: "디지털 정리를 하세요. 파일, 사진, 연락처를 정리하고 새롭게 시작하세요."
    },
    "관대": {
        1: "누군가를 칭찬하세요. 진심으로, 구체적으로 칭찬하세요.",
        2: "당당하게 자기소개를 하세요. 사람들 앞에서 자신을 드러내세요.",
        3: "새로운 사람을 만나세요. 모임에 참여하거나 먼저 말을 걸어보세요.",
        4: "자신의 성과를 정리하세요. 무엇을 이뤘는지 되돌아보고 기록하세요.",
        5: "중요한 발표나 프레젠테이션을 준비하세요. 당신을 보여줄 기회를 만드세요.",
        6: "리더십을 발휘하세요. 팀에서 먼저 의견을 내고 방향을 제시하세요.",
        7: "멋진 옷을 입고 외출하세요. 당신의 빛나는 모습을 세상에 보여주세요.",
        8: "사진을 찍으세요. 오늘의 당신을 기록으로 남기세요.",
        9: "당신의 강점을 활용하세요. 잘하는 것을 더 잘하는 데 집중하세요.",
        10: "무대에 서세요. 발표든 공연이든, 사람들 앞에 나서는 기회를 잡으세요."
    },
    "건록": {
        1: "일을 완수하세요. 시작한 프로젝트를 끝까지 마무리하세요.",
        2: "계획을 실행하세요. 생각만 하지 말고 바로 행동으로 옮기세요.",
        3: "운동하세요. 몸을 움직이며 에너지를 발산하세요.",
        4: "목표를 향해 전력 질주하세요. 집중해서 밀고 나가세요.",
        5: "맡은 일에 책임지세요. 끝까지 완수하는 모습을 보여주세요.",
        6: "효율적으로 일하세요. 불필요한 과정을 제거하고 핵심에 집중하세요.",
        7: "팀을 이끄세요. 방향을 제시하고 함께 나아가세요.",
        8: "성과를 내세요. 결과로 증명하세요.",
        9: "능력을 발휘하세요. 당신이 할 수 있는 최선을 다하세요.",
        10: "도전 과제를 해결하세요. 어려운 문제에 정면으로 맞서세요."
    },
    "제왕": {
        1: "중요한 결정을 내리세요. 더 이상 미루지 말고 결단하세요.",
        2: "팀을 이끌고 목표를 달성하세요. 리더로서 책임지세요.",
        3: "비전을 제시하세요. 앞으로 나아갈 방향을 명확히 하세요.",
        4: "당당하게 요구하세요. 필요한 것을 분명히 말하세요.",
        5: "권한을 행사하세요. 당신의 위치에서 할 수 있는 일을 하세요.",
        6: "큰 그림을 그리세요. 장기적인 계획을 세우고 실행하세요.",
        7: "영향력을 발휘하세요. 주변 사람들에게 긍정적인 영향을 주세요.",
        8: "정의를 실현하세요. 옳다고 생각하는 것을 당당히 주장하세요.",
        9: "책임을 지세요. 결과에 대해 당당히 책임지세요.",
        10: "통솔하세요. 흩어진 사람들을 하나로 모으세요."
    },
    "쇠": {
        1: "페이스를 조절하세요. 무리하지 말고 적당히 쉬어가세요.",
        2: "위임하세요. 모든 것을 혼자 하려 하지 말고 나눠주세요.",
        3: "우선순위를 정하세요. 중요한 것만 선택하고 나머지는 내려놓으세요.",
        4: "휴식을 취하세요. 잠시 멈추고 에너지를 재충전하세요.",
        5: "효율을 높이세요. 같은 시간에 더 적게 일하는 방법을 찾으세요.",
        6: "도움을 요청하세요. 혼자 버티지 말고 도움을 받으세요.",
        7: "속도를 늦추세요. 천천히 가도 괜찮아요.",
        8: "불필요한 일정을 취소하세요. 여유를 만드세요.",
        9: "자동화하세요. 반복 작업을 줄이는 방법을 찾으세요.",
        10: "간단하게 하세요. 복잡한 것을 단순하게 만드세요."
    },
    "병": {
        1: "쉬세요. 충분히 쉬는 것도 용기입니다.",
        2: "도움을 받으세요. 혼자 버티지 말고 손을 내미세요.",
        3: "솔직하게 말하세요. 힘들다고, 어렵다고 말하세요.",
        4: "병원이나 상담을 받으세요. 전문가의 도움을 받으세요.",
        5: "일정을 비우세요. 모든 약속을 취소하고 쉬세요.",
        6: "자신을 돌보세요. 몸과 마음을 챙기는 것이 우선입니다.",
        7: "억지로 버티지 마세요. 내려놓는 것도 힘입니다.",
        8: "회복에 집중하세요. 다른 것은 나중에 생각하세요.",
        9: "약한 모습을 보여도 괜찮아요. 완벽하지 않아도 됩니다.",
        10: "천천히 나아지세요. 조급해하지 말고 회복의 시간을 가지세요."
    },
    "사": {
        1: "정리하세요. 끝낼 것은 확실히 끝내세요.",
        2: "작별을 고하세요. 떠나보낼 것은 보내주세요.",
        3: "용서하세요. 자신과 타인을 용서하고 놓아주세요.",
        4: "마무리하세요. 미완성된 일을 완성하세요.",
        5: "감사를 표현하세요. 그동안 함께했던 것들에 감사하세요.",
        6: "정리 정돈하세요. 물건, 관계, 마음을 정리하세요.",
        7: "끝을 인정하세요. 끝난 것을 붙잡지 마세요.",
        8: "회고하세요. 지나온 시간을 돌아보고 의미를 찾으세요.",
        9: "놓아주세요. 집착을 내려놓고 자유로워지세요.",
        10: "마지막 인사를 하세요. 제대로 된 이별을 하세요."
    },
    "묘": {
        1: "숨을 고르세요. 깊게 호흡하며 마음을 진정시키세요.",
        2: "명상하세요. 조용히 앉아 내면을 들여다보세요.",
        3: "혼자만의 시간을 가지세요. 세상과 거리를 두세요.",
        4: "일기를 쓰세요. 마음속 생각을 글로 정리하세요.",
        5: "자연 속을 걸으세요. 고요함 속에서 평화를 찾으세요.",
        6: "독서하세요. 책 속에서 지혜를 찾으세요.",
        7: "생각을 정리하세요. 복잡한 마음을 차분히 정돈하세요.",
        8: "고요히 쉬세요. 아무것도 하지 않는 시간을 가지세요.",
        9: "내면의 소리를 들으세요. 마음이 원하는 것을 들어보세요.",
        10: "조용히 기도하거나 소원을 빌어보세요. 간절한 마음을 담아서요."
    },
    "절": {
        1: "모든 것을 내려놓으세요. 짐을 덜어내고 가벼워지세요.",
        2: "단식하거나 소식하세요. 비우는 연습을 하세요.",
        3: "연락을 끊으세요. 잠시 세상과 단절되는 시간을 가지세요.",
        4: "아무것도 하지 마세요. 진짜로 아무것도 하지 않는 시간을 가지세요.",
        5: "욕심을 버리세요. 가지려는 마음을 내려놓으세요.",
        6: "기대를 버리세요. 기대 없이 그냥 있어보세요.",
        7: "계획을 취소하세요. 모든 계획을 멈추고 쉬세요.",
        8: "비우세요. 가득 찬 것을 비워내세요.",
        9: "멈추세요. 달리던 것을 멈추고 서보세요.",
        10: "포기하세요. 붙잡고 있던 것을 놓아주세요."
    },
    "태": {
        1: "새로운 가능성을 탐색하세요. 조용히 알아보고 연구하세요.",
        2: "준비하세요. 앞으로 다가올 일을 차근차근 준비하세요.",
        3: "씨앗을 심으세요. 작은 시작을 하세요.",
        4: "공부하세요. 새로운 지식을 쌓으세요.",
        5: "구상하세요. 머릿속으로 그림을 그려보세요.",
        6: "조용히 시작하세요. 떠들지 말고 조용히 시작하세요.",
        7: "기반을 다지세요. 기초를 탄탄히 하세요.",
        8: "숨은 준비를 하세요. 남들 모르게 준비하세요.",
        9: "가능성을 키우세요. 작은 싹을 보호하며 키우세요.",
        10: "조용한 열정을 품으세요. 속으로 불타오르는 마음을 가지세요."
    },
    "양": {
        1: "꿈을 꾸세요. 상상력을 마음껏 펼치세요.",
        2: "계획을 세우세요. 앞으로의 청사진을 그리세요.",
        3: "영감을 받으세요. 예술, 자연, 사람에게서 영감을 얻으세요.",
        4: "상상하세요. 이루고 싶은 것을 머릿속에 생생하게 그려보세요.",
        5: "비전 보드를 만드세요. 원하는 미래를 시각화하세요.",
        6: "희망을 품으세요. 좋은 일이 일어날 거라 믿으세요.",
        7: "아이디어를 기록하세요. 떠오르는 생각을 모두 적으세요.",
        8: "미래를 그리세요. 1년 후, 5년 후의 당신을 상상하세요.",
        9: "가능성을 믿으세요. 될 거라고 믿으세요.",
        10: "조용히 키우세요. 아직 드러내지 말고 속으로 키우세요."
    }
}

# 갑인의 기본이미지 "봄날 호랑이와 함께하는 거목"에서 영감받은 창작 표현
creative_expressions = [
    "호랑이처럼 용맹한",
    "봄날처럼 생동하는",
    "거목처럼 우뚝 선",
    "숲을 지키는",
    "새싹처럼 뻗어나가는",
    "산을 달리는",
    "포효하는",
    "개척하는",
    "앞장서는",
    "하늘을 향한",
    "뿌리 깊은",
    "기운 넘치는",
    "당당한",
    "거침없는",
    "정의로운",
    "용기 있는",
    "생명력 가득한",
    "도약하는",
    "전진하는",
    "불꽃 같은"
]

# 시간 표현 제거 패턴
time_patterns = [
    r'오늘\s*아침\s*',
    r'저녁쯤\s*',
    r'저녁에\s*',
    r'오후쯤\s*',
    r'오후에\s*',
    r'새벽\s*',
    r'아침에\s*',
    r'밤에\s*',
    r'저녁엔\s*'
]

# 파일 읽기
with open('today_unse/stories/02_갑인.json', 'r', encoding='utf-8') as f:
    data = json.load(f)

# 사용 횟수 추적
usage_count = {expr: 0 for expr in creative_expressions}

def get_creative_expression():
    """가장 적게 사용된 표현 선택"""
    min_usage = min(usage_count.values())
    candidates = [expr for expr, count in usage_count.items() if count == min_usage]
    selected = random.choice(candidates)
    usage_count[selected] += 1
    return selected

# 운세의 모든 메시지 처리
for unsung_name, fortunes in data['운세'].items():
    for idx, fortune in enumerate(fortunes, 1):
        # 액션 업데이트
        if unsung_name in actions_02 and idx in actions_02[unsung_name]:
            fortune['액션'] = actions_02[unsung_name][idx]

        # 본문에서 {핵심특성} 플레이스홀더 대체 및 "~~한 당신," 표현 정리
        if '본문' in fortune:
            본문 = fortune['본문']

            # {핵심특성} 플레이스홀더 대체
            if '{핵심특성}' in 본문:
                new_expr = get_creative_expression()
                본문 = 본문.replace('{핵심특성}', new_expr)

            # "~~한 당신," 패턴을 더 자연스럽게 변경
            # 예: "거목처럼 우뚝 선 당신," → "거목처럼 우뚝 서서"
            # 예: "호랑이처럼 용맹한 당신," → "호랑이의 용맹함으로"
            본문 = re.sub(r'(\S+한)\s*당신,\s*\n', r'\1\n', 본문)
            본문 = re.sub(r'(\S+한)\s*당신이\s*\n', r'\1 모습이\n', 본문)

            fortune['본문'] = 본문

        # 액션에서 시간 표현 제거
        if '액션' in fortune:
            액션 = fortune['액션']
            for time_pattern in time_patterns:
                액션 = re.sub(time_pattern, '', 액션)
            # 연속 공백 정리
            액션 = re.sub(r'\s+', ' ', 액션).strip()
            fortune['액션'] = 액션

# 파일 저장
with open('today_unse/stories/02_갑인.json', 'w', encoding='utf-8') as f:
    json.dump(data, f, ensure_ascii=False, indent=2)

print("[OK] 02_갑인.json 완료")
print("- 플레이스홀더 대체: {핵심특성} → 창작 표현")
print("- 액션 구체화: 120개")
print("- 시간 표현 제거 완료")
print("- 갑인 특성 반영: 용맹함, 추진력, 개척정신, 정의감")
