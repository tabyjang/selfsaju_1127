# 📜 사주 용신(用神) 분석 및 시각화 통합 개발 마스터 플랜

## 1. 개요 (Overview)
본 문서는 명리학의 추상적 이론을 **정량적 수치 알고리즘**으로 변환하고, 이를 일반 사용자에게 **직관적인 UI**로 시각화하여 제공하기 위한 통합 개발 명세서이다.

* **목표:** 복잡한 한자 없이 그래프와 비유(온도계, 저울 등)로 내 사주의 균형과 해결책(용신)을 제시한다.
* **핵심:** `사주 용신수치화.md`의 정량적 계산 모델과 `사주 용신 알고리즘.md`의 우선순위 판단 로직을 통합 구현한다.

---

## 2. 개발 프로세스 (Development Phases)

### 🚀 Phase 1: 데이터 구조 설계 및 기초 전처리 (Base Layer)
**목표:** 생년월일시를 입력받아 기본적인 사주 구조체와 절기 데이터를 준비한다.

1.  **데이터 구조체 정의 (`types/saju.ts`)**
    * `SajuInput`: 양력/음력, 평달/윤달, 시각 보정 여부
    * `SajuChart`: 8글자(천간/지지), 오행, 십성 정보
    * `Seasonality`: 절입일 기준 월령(Command), 사령(Ruler - 초기/중기/본기) 데이터

2.  **유틸리티 구현**
    * `calculateSolarTerm(date)`: 절입일 계산 및 월주 보정.
    * `getHiddenStems(branch, daysSinceSolarTerm)`: 월지 지장간 사령(초기/중기/본기) 판별 함수.

---

### 🧮 Phase 2: 오행 세력 정밀 수치화 (Quantification Engine)
**목표:** `사주 용신수치화.md`에 기반하여, 단순 개수가 아닌 '실질적 에너지 총량'을 계산한다.

#### 2.1. 위치 가중치 행렬 ($W_p$) 적용
각 글자의 위치에 따라 기본 점수($BaseMass$)에 가중치를 곱한다.
* **월지(Month Branch):** 가중치 **3.0** (계절/환경 - 가장 강력)
* **일지(Day Branch):** 가중치 **1.5** (배우자궁 - 나와 밀접)
* **시지(Hour Branch):** 가중치 **1.2** (말년/잠재력)
* **천간(Stems):** 가중치 **1.0** (지지에 뿌리가 없으면 0.5로 감산 로직 추가)

#### 2.2. 동적 상호작용 (Dynamic Interactions) 구현
* **합화(Combination) 로직:**
    * 천간합(예: 갑기합토): 월령을 얻었는가? (진합 vs 기반)
        * `True` → 두 글자 점수 합산 후 변환된 오행에 **1.5배** 가산.
        * `False` → 묶임(Tying)으로 간주, 각 점수 **50% 삭감**.
    * 지지합(삼합/방합): 국(Bureau)을 형성하면 해당 오행 점수 **2.0배** 증폭.
* **충(Clash) 로직:**
    * 충돌하는 두 오행의 점수를 각각 **30%~50% 삭감** (왕지충 > 생지충 > 고지충).

---

### ⚖️ Phase 3: 신강/신약 및 조후 진단 (Diagnostic Engine)
**목표:** 일간의 강약과 사주의 온도(조후)를 수치로 진단한다.

#### 3.1. 신강(身强)/신약(身弱) 판정
* **아군 점수 ($Force_{Support}$):** 비겁 + 인성
* **적군 점수 ($Force_{Drain}$):** 식상 + 재성 + 관성
* **통근(Rooting) 계수 ($\alpha$):**
    * 일간이 월지에 뿌리가 있음: **x1.5**
    * 일간이 일지에 뿌리가 있음: **x1.3**
    * 무근(뿌리 없음): **x0.7** (인성이 많아도 신약 처리)
* **최종 판정:** `(아군 점수 × 통근 계수) - 적군 점수` = **신강약 지수**

#### 3.2. 조후(Climate) 지수 산출
* **월지 기준 온도 점수표:**
    * 자/축월 (-10 ~ -8): 혹한 → **조후 용신(화)** 필수
    * 오/미월 (+8 ~ +10): 혹서 → **조후 용신(수)** 필수
    * 인/묘/신/유월: 조후보다 억부 우선.

---

### 💎 Phase 4: 최적 용신 산출 및 의사결정 (Decision Maker)
**목표:** 4가지 관점(조후, 통관, 억부, 병약)을 통합하여 최종 추천 오행을 결정한다.

#### 4.1. 우선순위 알고리즘 (Priority Logic)
1.  **Check 1: 조후 위급 (Critical Climate)**
    * 조후 지수가 `±7` 이상인가? → `True`면 **조후 용신** 리턴.
2.  **Check 2: 통관 필요 (Traffic Jam)**
    * 두 오행(예: 금 vs 목)이 전체 세력의 30%씩 차지하며 대립하는가? → `True`면 **통관 용신** 리턴.
3.  **Check 3: 종격/특수격 (Special Pattern)**
    * 특정 오행이 70% 이상인가? → 종격 용신 리턴.
4.  **Check 4: 억부 (General Balance)**
    * 위 조건이 아니면 일반 억부 용신 리턴.
    * 신강 → 설기(식상) or 제어(관성)
    * 신약 → 생조(인성) or 방조(비겁)

#### 4.2. 최종 산출물 (Output)
* **Primary Yongsin:** 최우선 추천 오행 (수호신).
* **Secondary Yongsin (희신):** 보조 오행.
* **Worst Element (기신):** 피해야 할 오행.

---

## 3. 프론트엔드 시각화 명세 (UI/UX Display)
사용자에게는 복잡한 점수 대신 **직관적인 비유**로 결과를 보여준다.

### 📊 Section A: 오행 에너지 지도 (Energy Map)
* **Component:** `<OhaengForceDisplay />` (기존 컴포넌트 고도화)
* **Visual:** 레이더 차트 + 막대 그래프.
* **Logic:** Phase 2에서 계산된 최종 점수를 `%`로 환산하여 표시.
* **Feature:**
    * 가장 강한 오행에 **왕관(👑) 아이콘** 표시.
    * 점수가 0인 오행은 흐릿하게 처리하고 **"결핍"** 뱃지 부착.

### ⚖️ Section B: 신강/신약 밸런스 (Balance Scale)
* **Component:** `<BalanceScale />`
* **Visual:** **양팔 저울** 일러스트.
    * Left Pan: 인성 + 비겁 (나를 돕는 힘)
    * Right Pan: 식상 + 재성 + 관성 (힘을 쓰는 곳)
* **Interaction:** 신강약 지수에 따라 저울이 기울어지는 CSS 애니메이션 적용.
* **Label:** "극신강 / 신강 / **중화(Golden)** / 신약 / 극신약"

### 🌡️ Section C: 사주 온도계 (Climate Thermometer)
* **Component:** `<ClimateMonitor />`
* **Visual:** **온도계** 바 (Bar).
    * Blue(한습) ↔ Green(쾌적) ↔ Red(조열)
* **Logic:** Phase 3의 조후 지수(-10 ~ +10)를 매핑하여 인디케이터 위치 표시.
* **Message:**
    * "사주가 꽁꽁 얼어있습니다. 따뜻한 불 기운이 시급합니다."
    * "사주가 너무 뜨겁습니다. 시원한 물 기운이 필요합니다."

### 🛡️ Section D: 수호신 카드 (Final Solution)
* **Component:** `<YongsinCard />`
* **Visual:** 게임 아이템 카드 / 타로 카드 스타일.
* **Contents:**
    * **Image:** 용신 오행을 상징하는 일러스트 (태양, 바다, 거목, 바위, 대지).
    * **Keywords:** #열정 #표현 #따뜻함 (성격 키워드 매칭).
    * **Action Plan:** 개운법 제안 (예: "검은색 옷 입기", "북쪽으로 머리 두기").

---

## 4. 폴더 구조 제안 (Project Structure)
```text
src/
├── utils/
│   ├── saju/
│   │   ├── calculator.ts    (가중치/합충 점수 계산)
│   │   ├── seasonality.ts   (절기/조후 계산)
│   │   ├── yongsin.ts       (용신 결정 우선순위 로직)
│   │   └── types.ts         (타입 정의)
├── components/
│   ├── analysis/
│   │   ├── OhaengChart.tsx  (오행 차트)
│   │   ├── BalanceScale.tsx (신강약 저울)
│   │   ├── ClimateBar.tsx   (조후 온도계)
│   │   └── YongsinCard.tsx  (결과 카드)
│   └── AnalysisResult.tsx   (통합 결과 페이지)