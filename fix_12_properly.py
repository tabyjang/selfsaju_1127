import json
import sys
import io
import re

# UTF-8 인코딩 강제 설정
sys.stdout = io.TextIOWrapper(sys.stdout.buffer, encoding='utf-8')

with open('today_unse/stories/12_을해.json', 'r', encoding='utf-8') as f:
    data = json.load(f)

# 12_을해.json의 각 항목별 맞춤 액션 작성
# 제목과 본문을 고려한 정성스러운 액션

custom_actions = {
    # 장생
    ("장생", 1): "시작하세요. 자유로운 마음으로 새로운 일을, 용기 내어 첫걸음을 내딛으세요.",
    ("장생", 2): "행동하세요. 몰입력을 발휘해 당신의 에너지를, 세상에 활짝 펼쳐보세요.",
    ("장생", 3): "감사하세요. 후원해준 분들께 사려 깊게, 진심 어린 마음을 전하세요.",
    ("장생", 4): "전진하세요. 순수한 열정으로 흔들림 없이, 당당하게 밀고 나가세요.",
    ("장생", 5): "회복하세요. 평정심을 되찾으며 긍정의 에너지로, 활력을 충전하세요.",
    ("장생", 6): "소통하세요. 철학적인 깊이를 담아, 사람들과 매력적으로 연결되세요.",
    ("장생", 7): "성장하세요. 싹을 틔우듯 꾸준히 과정을, 차분하게 즐기며 나아가세요.",
    ("장생", 8): "시작하세요. 연꽃처럼 진흙 속에서도 고결하게, 세상을 향해 나아가세요.",
    ("장생", 9): "배우세요. 스펀지처럼 열린 마음으로, 지혜를 깊이 흡수하세요.",
    ("장생", 10): "출항하세요. 뗏목처럼 자유롭게 새로운 바다를, 용기 내어 떠나세요.",

    # 목욕
    ("목욕", 1): "만끽하세요. 오감을 활짝 열어 아름다움을, 온전히 느끼며 즐기세요.",
    ("목욕", 2): "드러내세요. 당신의 매력을 직관을 믿고, 자신 있게 세상에 보여주세요.",
    ("목욕", 3): "시도하세요. 새로운 변화를 담백하게, 신선한 마음으로 경험하세요.",
    ("목욕", 4): "느끼세요. 감정의 물결을 거부하지 말고, 있는 그대로 받아들이세요.",
    ("목욕", 5): "돌보세요. 자신을 소중히 여기며 마음껏, 휴식과 위로를 주세요.",
    ("목욕", 6): "관찰하세요. 예민한 직관으로 주변을, 섬세하게 살펴보세요.",
    ("목욕", 7): "표현하세요. 감각적인 언어로 생각을, 세련되게 드러내세요.",
    ("목욕", 8): "맡기세요. 흐르는 물처럼 자연스럽게, 상황에 유연하게 적응하세요.",
    ("목욕", 9): "쉬세요. 감정의 파도가 지나가길, 고요히 기다리며 회복하세요.",
    ("목욕", 10): "즐기세요. 깊은 감성으로 예술을, 온 마음을 다해 느껴보세요.",

    # 관대
    ("관대", 1): "성장하세요. 도전을 두려워하지 말고, 한 단계씩 차근히 올라가세요.",
    ("관대", 2): "준비하세요. 철저히 계획을 세우고, 완벽하게 실행할 준비를 마치세요.",
    ("관대", 3): "책임지세요. 맡은 일을 신중하게, 성실히 완수해내세요.",
    ("관대", 4): "인정받으세요. 실력을 차분히 보여주며, 주변의 신뢰를 얻으세요.",
    ("관대", 5): "자립하세요. 스스로 서는 힘을 조용히, 꾸준히 키워나가세요.",
    ("관대", 6): "발휘하세요. 실력을 마음껏, 자신 있게 세상에 드러내세요.",
    ("관대", 7): "확립하세요. 당신의 위치를 명확히, 단단하게 다져가세요.",
    ("관대", 8): "이루세요. 철학적 깊이로 성취를, 의미 있게 완성하세요.",
    ("관대", 9): "나아가세요. 고요한 결단력으로 앞으로, 담담하게 전진하세요.",
    ("관대", 10): "완성하세요. 관대의 안정 속에서 준비를, 깔끔하게 마무리하세요.",

    # 건록
    ("건록", 1): "유지하세요. 안정된 리듬을 평정심 있게, 꾸준히 지켜가세요.",
    ("건록", 2): "발휘하세요. 깊이 쌓은 실력을 자신 있게, 확실히 보여주세요.",
    ("건록", 3): "자급하세요. 스스로 해결하는 힘을 차분히, 키워나가세요.",
    ("건록", 4): "거두세요. 근면한 노력의 결실을 당당히, 누리세요.",
    ("건록", 5): "균형잡으세요. 일과 휴식의 조화를 지혜롭게, 맞춰가세요.",
    ("건록", 6): "인정받으세요. 전문성을 묵묵히 쌓아, 존경을 얻으세요.",
    ("건록", 7): "다지세요. 단단한 기반을 철저히, 차근차근 쌓아가세요.",
    ("건록", 8): "키우세요. 집중력을 깊이 발휘해, 내실을 탄탄히 다지세요.",
    ("건록", 9): "지키세요. 원칙을 고요히 따르며, 흔들림 없이 유지하세요.",
    ("건록", 10): "완성하세요. 건록의 힘으로 실력을, 완벽히 갖추세요.",

    # 제왕
    ("제왕", 1): "빛나세요. 최고의 순간을 평정심 있게, 당당히 누리세요.",
    ("제왕", 2): "이끄세요. 리더십을 발휘해 사람들을, 지혜롭게 이끌어가세요.",
    ("제왕", 3): "누리세요. 완벽한 컨디션으로 오늘을, 마음껏 즐기세요.",
    ("제왕", 4): "확대하세요. 영향력을 차분히 넓히며, 책임감 있게 펼치세요.",
    ("제왕", 5): "만끽하세요. 성취의 정점에서 기쁨을, 겸손히 나누세요.",
    ("제왕", 6): "드러내세요. 자신감을 깊이 있게, 품격 있게 표현하세요.",
    ("제왕", 7): "감동시키세요. 카리스마를 발산하며 사람들을, 진심으로 이끄세요.",
    ("제왕", 8): "실현하세요. 철학을 현실로 만들어, 뜻깊게 이루세요.",
    ("제왕", 9): "주도하세요. 고요한 카리스마로 상황을, 차분히 이끌어가세요.",
    ("제왕", 10): "완성하세요. 제왕의 기운으로 비전을, 완벽히 구현하세요.",

    # 쇠
    ("쇠", 1): "여유부리세요. 느긋한 마음으로 하루를, 평온하게 보내세요.",
    ("쇠", 2): "사색하세요. 지혜를 깊이 생각하며, 통찰을 얻으세요.",
    ("쇠", 3): "안정하세요. 평온함을 차분히 추구하며, 마음을 가라앉히세요.",
    ("쇠", 4): "발휘하세요. 노련한 지혜를 적절히, 상황에 맞게 활용하세요.",
    ("쇠", 5): "챙기세요. 실속을 알뜰히 따지며, 실리를 챙기세요.",
    ("쇠", 6): "지키세요. 신념을 은근히 고집하며, 흔들리지 마세요.",
    ("쇠", 7): "쉬세요. 충분한 휴식으로 몸과 마음을, 깊이 재충전하세요.",
    ("쇠", 8): "숙고하세요. 사려 깊게 생각하며, 차분히 결정하세요.",
    ("쇠", 9): "유지하세요. 고요한 안정 속에서 평온을, 담담히 지키세요.",
    ("쇠", 10): "정리하세요. 여유롭게 쇠의 지혜로, 필요한 것만 남기세요.",

    # 병
    ("병", 1): "느끼세요. 예민한 감각으로 세상을, 섬세하게 관찰하세요.",
    ("병", 2): "상상하세요. 풍부한 상상력으로 가능성을, 자유롭게 펼치세요.",
    ("병", 3): "공감하세요. 동정심을 발휘해 타인을, 따뜻하게 이해하세요.",
    ("병", 4): "표현하세요. 예술적 감성으로 아름다움을, 창조하세요.",
    ("병", 5): "베푸세요. 다정다감하게 마음을, 아낌없이 나누세요.",
    ("병", 6): "이동하세요. 역마의 기운을 타고 새로운 곳으로, 떠나보세요.",
    ("병", 7): "사색하세요. 정신적 깊이를 추구하며, 내면을 키우세요.",
    ("병", 8): "감싸세요. 따뜻한 마음으로 상처를, 부드럽게 치유하세요.",
    ("병", 9): "몰입하세요. 철학적 사유에 깊이, 빠져들어가세요.",
    ("병", 10): "느끼세요. 고요한 감수성으로 세상을, 온전히 받아들이세요.",

    # 사
    ("사", 1): "마무리하세요. 깔끔하게 정리하며, 완결을 지어가세요.",
    ("사", 2): "돌아보세요. 내면으로 깊이 들어가, 자신을 성찰하세요.",
    ("사", 3): "종결하세요. 담담하게 마무리하며, 새로운 준비를 시작하세요.",
    ("사", 4): "고요하세요. 평온함 속에서 내면의 소리를, 차분히 들으세요.",
    ("사", 5): "정산하세요. 차분히 정리하며 다음을, 준비하세요.",
    ("사", 6): "멈추세요. 잠시 쉬어가며 지혜를, 되새기세요.",
    ("사", 7): "비우세요. 불필요한 것을 내려놓고, 마음을 가볍게 하세요.",
    ("사", 8): "완결하세요. 철학적 통찰로 끝을, 의미 있게 맺으세요.",
    ("사", 9): "내려놓으세요. 고요히 손을 떼며, 새로운 시작을 준비하세요.",
    ("사", 10): "마치세요. 사의 지혜로 마무리를, 깔끔하게 지으세요.",

    # 묘
    ("묘", 1): "품으세요. 잠재된 힘을 조용히, 내면에 키워가세요.",
    ("묘", 2): "키우세요. 내면의 성장에 집중하며, 차곡차곡 쌓아가세요.",
    ("묘", 3): "저장하세요. 에너지를 아껴두며, 미래를 대비하세요.",
    ("묘", 4): "준비하세요. 조용히 차근차근, 보이지 않게 준비하세요.",
    ("묘", 5): "침잠하세요. 깊이 잠기며 지혜를, 차분히 축적하세요.",
    ("묘", 6): "발견하세요. 숨겨진 가치를 천천히, 찾아내세요.",
    ("묘", 7): "축적하세요. 꾸준히 쌓아가며 기반을, 탄탄히 다지세요.",
    ("묘", 8): "기다리세요. 철학적 인내로 때를, 고요히 준비하세요.",
    ("묘", 9): "보존하세요. 소중한 것을 차분히, 잘 간직하세요.",
    ("묘", 10): "품으세요. 묘의 기운으로 씨앗을, 조용히 키우세요.",

    # 절
    ("절", 1): "새롭게 하세요. 마음을 깨끗이 비우고, 산뜻하게 출발하세요.",
    ("절", 2): "결정하세요. 쿨하게 과감히, 선택하세요.",
    ("절", 3): "리셋하세요. 인생을 새롭게 정리하고, 다시 시작하세요.",
    ("절", 4): "정리하세요. 뒤끝 없이 깨끗하게, 마음을 비우세요.",
    ("절", 5): "기대하세요. 반전의 기운을 믿고, 새로운 시작을 맞이하세요.",
    ("절", 6): "출발하세요. 순수한 마음으로, 처음처럼 나아가세요.",
    ("절", 7): "날아가세요. 자유로운 영혼으로, 구애 없이 떠나세요.",
    ("절", 8): "끊으세요. 철학적 결단으로 과거를, 깔끔히 정리하세요.",
    ("절", 9): "비우세요. 고요히 집착을 내려놓고, 자유로워지세요.",
    ("절", 10): "새로 시작하세요. 절의 지혜로 과거를 끊고, 미래로 나아가세요.",

    # 태
    ("태", 1): "품으세요. 잉태의 기운으로 씨앗을, 조용히 키우세요.",
    ("태", 2): "준비하세요. 시작을 신중히, 차근차근 준비하세요.",
    ("태", 3): "자라세요. 조용한 성장에 집중하며, 내실을 다지세요.",
    ("태", 4): "심으세요. 좋은 씨앗을 정성껏, 미래에 심으세요.",
    ("태", 5): "보호하세요. 소중한 것을 애정으로, 잘 지켜가세요.",
    ("태", 6): "기대하세요. 가능성을 믿으며, 희망을 키우세요.",
    ("태", 7): "준비하세요. 숨은 준비를 차분히, 꾸준히 이어가세요.",
    ("태", 8): "키우세요. 철학의 씨앗을 정성껏, 조용히 가꾸세요.",
    ("태", 9): "품으세요. 고요히 생명을 키우며, 때를 기다리세요.",
    ("태", 10): "잉태하세요. 태의 지혜로 새로움을, 조용히 품으세요.",

    # 양
    ("양", 1): "양육하세요. 정성껏 돌보며, 성장을 도우세요.",
    ("양", 2): "키우세요. 성장의 기운으로 가능성을, 아낌없이 키우세요.",
    ("양", 3): "지원하세요. 필요한 도움을, 아낌없이 베푸세요.",
    ("양", 4): "가르치세요. 지혜를 나누며 성장을, 함께 이루세요.",
    ("양", 5): "발달시키세요. 꾸준한 노력으로, 성장을 이끄세요.",
    ("양", 6): "보살피세요. 세심하게 돌보며, 애정을 쏟으세요.",
    ("양", 7): "인내하세요. 꾸준히 기다리며, 성과를 이루세요.",
    ("양", 8): "돌보세요. 철학적 애정으로 성장을, 지혜롭게 돕세요.",
    ("양", 9): "기다리세요. 고요히 성장을 지켜보며, 때를 기다리세요.",
    ("양", 10): "완성하세요. 양의 기운으로 양육을, 온전히 마무리하세요.",
}

fixed_count = 0

for unsung_name, fortunes in data['운세'].items():
    for fortune in fortunes:
        # 본문 문법 수정
        if '본문' in fortune:
            original = fortune['본문']
            본문 = original

            # 을(를) 패턴 제거 (받침에 따라)
            def replace_particle(match):
                word = match.group(1)
                last_char = word[-1]
                has_jongseong = (ord(last_char) - 0xAC00) % 28 != 0
                return word + ("을" if has_jongseong else "를")

            본문 = re.sub(r'([가-힣]+)을\(를\)', replace_particle, 본문)

            # "XXX로" 패턴 수정
            본문 = re.sub(r'연구하듯로', '연구하듯', 본문)
            본문 = re.sub(r'([가-힣]+게)로\s', r'\1 ', 본문)
            본문 = re.sub(r'([가-힣]+히)로\s', r'\1 ', 본문)

            # "XXX 하며" 패턴 수정
            본문 = re.sub(r'차분히 하며', '차분하게', 본문)
            본문 = re.sub(r'맑게 하며', '맑게', 본문)
            본문 = re.sub(r'([가-힣]+게) 하며', r'\1', 본문)
            본문 = re.sub(r'([가-힣]+히) 하며', r'\1', 본문)

            if 본문 != original:
                fortune['본문'] = 본문

        # 액션 교체
        if '액션' in fortune:
            key = (unsung_name, fortune['v'])
            if key in custom_actions:
                fortune['액션'] = custom_actions[key]
                fixed_count += 1

with open('today_unse/stories/12_을해.json', 'w', encoding='utf-8') as f:
    json.dump(data, f, ensure_ascii=False, indent=2)

print(f"{'='*60}")
print(f"✅ 12_을해.json 정성스럽게 수정 완료!")
print(f"{'='*60}")
print(f"  액션 재작성: {fixed_count}개")
print(f"  본문 문법 수정 완료")
print(f"{'='*60}")
