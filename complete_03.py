import json
import re
import random

# 03_갑진.json - 비옥한 땅 위의 푸른 용
# 특성: 큰 그릇, 포용력, 전략적 사고, 비전, 대범함, 통찰력, 스케일이 큼

# 갑진 일주에 맞는 120개의 구체적인 액션
actions_03 = {
    "장생": {
        1: "평소보다 더 큰 목표를 세워보세요. 10년 후를 내다보는 거대한 그림을 그려보세요.",
        2: "오래 준비해온 프로젝트나 계획에 본격적으로 시동을 거세요. 시작할 준비가 되었습니다.",
        3: "갈등 상황이 있다면 한 발 물러나 전체를 조망하세요. 큰 그림에서 해결책을 찾으세요.",
        4: "협상이나 대화가 필요하다면 미소 띤 얼굴로 부드럽게 접근하세요. 여유가 승리를 가져옵니다.",
        5: "직감이 말하는 것에 귀 기울이세요. 오늘 떠오르는 아이디어를 메모하고 발전시키세요.",
        6: "3년 후의 당신을 구체적으로 상상해보세요. 어디서 무엇을 하고 있는지 글로 적으세요.",
        7: "소소한 것에 만족하지 말고 크게 생각하세요. 당신의 스케일에 맞는 큰 일을 구상하세요.",
        8: "미루던 중요한 결정을 오늘 내리세요. 용기를 내서 큰 도약을 시작하세요.",
        9: "다른 사람의 의견에도 열린 마음으로 귀 기울이세요. 거기서 새로운 통찰을 얻을 수 있습니다.",
        10: "뉴스, 트렌드, 산업 동향을 살펴보세요. 기회를 찾아내고 전략을 세우세요."
    },
    "목욕": {
        1: "오래된 습관이나 패턴 하나를 골라 바꿔보세요. 새로운 방식으로 하루를 시작하세요.",
        2: "감정이 흔들리더라도 억누르지 마세요. 느끼고, 받아들이고, 흘려보내세요.",
        3: "늘 가던 길 대신 새로운 길로 가보세요. 다른 경로를 시도하며 새로운 것을 발견하세요.",
        4: "오래된 물건이나 옷을 정리하세요. 새것을 위한 공간을 만드세요.",
        5: "과거의 실패나 상처를 떠올리고 용서하세요. 자신과 타인 모두를 용서하세요.",
        6: "샤워하면서 몸과 마음을 깨끗이 씻어내세요. 복잡한 생각도 함께 흘려보내세요.",
        7: "익숙한 생각의 틀을 깨보세요. 반대 관점에서 문제를 바라보세요.",
        8: "새로운 스타일이나 이미지를 시도해보세요. 작은 변화로 새로운 나를 만나세요.",
        9: "불필요한 관계나 약속을 정리하세요. 진짜 중요한 것에 집중할 공간을 만드세요.",
        10: "디지털 공간을 정리하세요. 파일, 사진, 이메일을 정돈하며 마음도 정돈하세요."
    },
    "관대": {
        1: "당신의 성과나 강점을 정리해보세요. 무엇을 잘해왔는지 기록하고 인정하세요.",
        2: "사람들 앞에서 당당하게 자기소개를 하세요. 당신이 누구인지 분명히 드러내세요.",
        3: "새로운 모임이나 커뮤니티에 참여하세요. 사람들과 적극적으로 교류하세요.",
        4: "중요한 발표나 프레젠테이션을 준비하세요. 당신의 비전을 사람들에게 보여주세요.",
        5: "팀이나 그룹에서 리더 역할을 자처하세요. 방향을 제시하고 이끌어가세요.",
        6: "멋진 옷을 입고 당당하게 외출하세요. 당신의 빛나는 모습을 세상에 보여주세요.",
        7: "당신의 아이디어나 의견을 적극적으로 제안하세요. 주저하지 말고 목소리를 내세요.",
        8: "칭찬할 사람을 찾아 진심으로 칭찬하세요. 구체적이고 따뜻한 말로 표현하세요.",
        9: "당신의 강점을 최대한 활용할 기회를 찾으세요. 잘하는 것을 더 잘하는 데 집중하세요.",
        10: "사진을 찍거나 영상을 남기세요. 오늘의 빛나는 당신을 기록으로 남기세요."
    },
    "건록": {
        1: "시작한 프로젝트를 끝까지 완수하세요. 마무리까지 책임지고 해내세요.",
        2: "계획만 세우지 말고 즉시 실행하세요. 생각을 행동으로 옮기세요.",
        3: "운동이나 신체 활동을 하세요. 몸을 움직이며 에너지를 발산하세요.",
        4: "목표를 향해 집중적으로 밀고 나가세요. 방해 요소를 제거하고 전력 질주하세요.",
        5: "맡은 일에 대해 끝까지 책임지세요. 중간에 포기하지 말고 완수하세요.",
        6: "효율적인 작업 방식을 찾으세요. 불필요한 과정을 제거하고 핵심에 집중하세요.",
        7: "팀원들과 협력하여 큰 목표를 달성하세요. 함께 힘을 합쳐 밀고 나가세요.",
        8: "결과로 증명하세요. 말보다 성과로 당신의 능력을 보여주세요.",
        9: "최대한의 능력을 발휘하세요. 100% 집중하여 최선을 다하세요.",
        10: "어려운 도전 과제에 정면으로 맞서세요. 회피하지 말고 해결하세요."
    },
    "제왕": {
        1: "중요한 의사 결정을 내리세요. 더 이상 미루지 말고 결단하고 실행하세요.",
        2: "팀을 이끌고 목표를 달성하세요. 리더로서 방향을 제시하고 책임지세요.",
        3: "장기적인 비전을 제시하세요. 10년 후를 내다보는 큰 그림을 그리고 공유하세요.",
        4: "필요한 것을 분명하고 당당하게 요구하세요. 주저하지 말고 말하세요.",
        5: "당신의 권한과 영향력을 긍정적으로 행사하세요. 좋은 변화를 만드세요.",
        6: "전략적인 계획을 세우고 실행하세요. 단계별로 체계적으로 추진하세요.",
        7: "주변 사람들에게 긍정적인 영향을 미치세요. 좋은 본보기가 되세요.",
        8: "옳다고 믿는 것을 당당히 주장하세요. 정의를 실현하기 위해 목소리를 내세요.",
        9: "결과에 대해 책임지세요. 성공이든 실패든 당당히 책임을 지세요.",
        10: "흩어진 사람들이나 의견을 하나로 모으세요. 통합하고 조율하세요."
    },
    "쇠": {
        1: "페이스를 조절하세요. 무리하지 말고 적절히 쉬어가며 진행하세요.",
        2: "모든 것을 혼자 하려 하지 말고 위임하세요. 역할을 나누고 함께 하세요.",
        3: "우선순위를 정하세요. 중요한 것만 선택하고 나머지는 과감히 내려놓으세요.",
        4: "충분한 휴식을 취하세요. 잠시 멈추고 에너지를 재충전하세요.",
        5: "효율을 높이는 방법을 찾으세요. 같은 시간에 더 적게 일하는 방법을 고민하세요.",
        6: "도움이 필요하면 요청하세요. 혼자 버티지 말고 손을 내미세요.",
        7: "속도를 늦추세요. 천천히 가도 괜찮습니다. 지속 가능한 속도를 찾으세요.",
        8: "불필요한 일정이나 약속을 취소하세요. 여유를 만들고 공간을 확보하세요.",
        9: "반복되는 작업을 자동화하세요. 시스템을 만들어 수고를 줄이세요.",
        10: "복잡한 것을 단순하게 만드세요. 불필요한 것을 제거하고 간결하게 하세요."
    },
    "병": {
        1: "충분히 쉬세요. 아무것도 하지 않고 그냥 쉬는 것도 용기입니다.",
        2: "도움을 받으세요. 혼자 버티지 말고 주변에 손을 내미세요.",
        3: "힘들다고 솔직하게 말하세요. 괜찮은 척하지 말고 진심을 표현하세요.",
        4: "전문가의 도움을 받으세요. 병원, 상담, 코칭 등 필요한 도움을 받으세요.",
        5: "모든 일정을 비우세요. 약속을 취소하고 완전히 쉬는 시간을 가지세요.",
        6: "자신을 돌보는 것에 집중하세요. 몸과 마음을 챙기는 것이 최우선입니다.",
        7: "억지로 버티지 마세요. 내려놓고 쉬는 것도 힘이고 지혜입니다.",
        8: "회복에만 집중하세요. 다른 것은 나중에 생각하고 지금은 쉬세요.",
        9: "완벽하지 않아도 괜찮습니다. 약한 모습을 보여도 괜찮습니다.",
        10: "조급해하지 말고 천천히 나아지세요. 회복의 시간을 충분히 가지세요."
    },
    "사": {
        1: "끝낼 것은 확실하게 끝내세요. 미련 없이 마무리하세요.",
        2: "떠나보낼 것은 보내주세요. 작별 인사를 하고 새로운 시작을 준비하세요.",
        3: "자신과 타인을 용서하세요. 원망을 내려놓고 평화를 선택하세요.",
        4: "미완성된 일을 완성하세요. 끝맺지 못한 것을 마무리하세요.",
        5: "그동안 함께했던 사람, 경험, 물건에 감사하세요. 감사의 마음을 표현하세요.",
        6: "물건, 관계, 마음을 정리하세요. 깨끗하게 정돈하고 마무리하세요.",
        7: "끝난 것을 인정하세요. 붙잡지 말고 놓아주세요.",
        8: "지나온 시간을 회고하세요. 무엇을 배웠는지, 어떻게 성장했는지 정리하세요.",
        9: "집착을 내려놓으세요. 가지려는 마음을 버리고 자유로워지세요.",
        10: "제대로 된 이별을 하세요. 마지막 인사를 건네고 떠나보내세요."
    },
    "묘": {
        1: "깊게 호흡하세요. 숨을 고르며 마음을 진정시키고 평화를 찾으세요.",
        2: "조용히 앉아 명상하세요. 내면을 들여다보며 고요함 속에 머무세요.",
        3: "혼자만의 조용한 시간을 가지세요. 세상과 거리를 두고 나를 만나세요.",
        4: "일기를 쓰세요. 마음속 생각과 감정을 글로 정리하고 정돈하세요.",
        5: "자연 속을 걸으세요. 산, 바다, 공원에서 고요함과 평화를 느끼세요.",
        6: "책을 읽으세요. 지혜를 담은 책 속에서 답을 찾으세요.",
        7: "복잡한 생각을 정리하세요. 마음을 차분히 가라앉히고 정돈하세요.",
        8: "아무것도 하지 않는 시간을 가지세요. 그냥 고요히 쉬세요.",
        9: "내면의 소리에 귀 기울이세요. 마음이 진정 원하는 것을 들어보세요.",
        10: "조용히 기도하거나 소원을 빌어보세요. 간절한 마음을 담아서 빌어보세요."
    },
    "절": {
        1: "모든 것을 내려놓으세요. 짐을 덜어내고 가벼워지세요.",
        2: "단식하거나 소식하세요. 비우는 연습을 통해 본질을 발견하세요.",
        3: "잠시 세상과 단절되는 시간을 가지세요. 연락을 끊고 혼자만의 시간을 보내세요.",
        4: "진짜로 아무것도 하지 마세요. 계획도 없이 그냥 있어보세요.",
        5: "욕심을 버리세요. 가지려는 마음, 되려는 마음을 내려놓으세요.",
        6: "기대를 버리세요. 기대 없이 있는 그대로 받아들이세요.",
        7: "모든 계획을 취소하세요. 계획을 멈추고 완전히 쉬세요.",
        8: "가득 찬 것을 비워내세요. 마음, 공간, 시간을 비우세요.",
        9: "달리던 것을 멈추세요. 서서 주변을 둘러보세요.",
        10: "붙잡고 있던 것을 놓아주세요. 포기하고 자유로워지세요."
    },
    "태": {
        1: "새로운 가능성을 탐색하세요. 조용히 알아보고 연구하며 준비하세요.",
        2: "앞으로 다가올 일을 차근차근 준비하세요. 기반을 탄탄히 다지세요.",
        3: "작은 씨앗을 심으세요. 미래를 위한 작은 시작을 하세요.",
        4: "새로운 지식을 쌓으세요. 공부하고 배우며 역량을 키우세요.",
        5: "머릿속으로 구상하세요. 이루고 싶은 것을 상상하며 그림을 그리세요.",
        6: "조용히 시작하세요. 떠들지 말고 소리 없이 움직이기 시작하세요.",
        7: "기초를 탄탄히 하세요. 기반이 단단해야 높이 올라갈 수 있습니다.",
        8: "남들 모르게 준비하세요. 숨은 노력으로 실력을 쌓으세요.",
        9: "작은 싹을 보호하며 키우세요. 아직 약한 가능성을 잘 돌보세요.",
        10: "조용한 열정을 품으세요. 속으로 불타오르는 마음을 간직하세요."
    },
    "양": {
        1: "꿈을 꾸세요. 상상력을 마음껏 펼치며 원하는 미래를 그려보세요.",
        2: "구체적인 계획을 세우세요. 앞으로의 청사진을 단계별로 그리세요.",
        3: "영감을 받으세요. 예술, 자연, 사람에게서 창조적 영감을 얻으세요.",
        4: "이루고 싶은 것을 머릿속에 생생하게 그려보세요. 상상을 현실처럼 느껴보세요.",
        5: "비전 보드를 만드세요. 원하는 미래를 이미지로 시각화하세요.",
        6: "희망을 품으세요. 좋은 일이 일어날 거라 믿고 기대하세요.",
        7: "떠오르는 아이디어를 모두 기록하세요. 생각을 글이나 그림으로 남기세요.",
        8: "1년 후, 5년 후의 당신을 상상하세요. 미래의 모습을 구체적으로 그리세요.",
        9: "가능성을 믿으세요. 될 거라고, 이룰 수 있다고 믿으세요.",
        10: "아직 드러내지 말고 조용히 키우세요. 속으로 키우며 때를 기다리세요."
    }
}

# 갑진의 기본이미지 "비옥한 땅 위의 푸른 용"에서 영감받은 창작 표현
creative_expressions = [
    "용처럼 대범한",
    "땅처럼 넓은",
    "하늘을 보는",
    "큰 그릇의",
    "여유로운",
    "전략적인",
    "통찰력 있는",
    "비옥한 땅 같은",
    "푸른 용의",
    "포용력 있는",
    "비전을 가진",
    "스케일 큰",
    "부드러운",
    "지혜로운",
    "깊이 있는",
    "미래를 보는",
    "넓게 품는",
    "날아오르는",
    "세상을 읽는",
    "흐름을 아는"
]

# 시간 표현 제거 패턴
time_patterns = [
    r'오늘\s*아침\s*',
    r'저녁쯤\s*',
    r'저녁에\s*',
    r'오후쯤\s*',
    r'오후에\s*',
    r'새벽\s*',
    r'아침에\s*',
    r'밤에\s*',
    r'저녁엔\s*'
]

# 파일 읽기
with open('today_unse/stories/03_갑진.json', 'r', encoding='utf-8') as f:
    data = json.load(f)

# 사용 횟수 추적
usage_count = {expr: 0 for expr in creative_expressions}

def get_creative_expression():
    """가장 적게 사용된 표현 선택"""
    min_usage = min(usage_count.values())
    candidates = [expr for expr, count in usage_count.items() if count == min_usage]
    selected = random.choice(candidates)
    usage_count[selected] += 1
    return selected

# 운세의 모든 메시지 처리
for unsung_name, fortunes in data['운세'].items():
    for idx, fortune in enumerate(fortunes, 1):
        # 액션 업데이트
        if unsung_name in actions_03 and idx in actions_03[unsung_name]:
            fortune['액션'] = actions_03[unsung_name][idx]

        # 본문에서 {핵심특성} 플레이스홀더 대체
        if '본문' in fortune:
            본문 = fortune['본문']
            if '{핵심특성}' in 본문:
                new_expr = get_creative_expression()
                본문 = 본문.replace('{핵심특성}', new_expr)

            # "~~한 당신," 패턴 정리
            본문 = re.sub(r'(\S+)한\s+당신,\s*\n\s*오늘', r'\1하니,\n오늘', 본문)
            본문 = re.sub(r'(\S+)한\s+당신이니까', r'\1하니까', 본문)
            본문 = re.sub(r'(\S+)한\s+당신의\s*\n', r'\1한 이의\n', 본문)
            본문 = re.sub(r'(\S+)한\s+당신도\s*\n', r'\1하게\n', 본문)

            fortune['본문'] = 본문

        # 액션에서 시간 표현 제거
        if '액션' in fortune:
            액션 = fortune['액션']
            for time_pattern in time_patterns:
                액션 = re.sub(time_pattern, '', 액션)
            # 연속 공백 정리
            액션 = re.sub(r'\s+', ' ', 액션).strip()
            fortune['액션'] = 액션

# 파일 저장
with open('today_unse/stories/03_갑진.json', 'w', encoding='utf-8') as f:
    json.dump(data, f, ensure_ascii=False, indent=2)

print("[OK] 03_갑진.json 완료")
print("- 플레이스홀더 대체: {핵심특성} → 창작 표현")
print("- 액션 구체화: 120개 (평균 50자 이상)")
print("- 시간 표현 제거 완료")
print("- 갑진 특성 반영: 큰 그릇, 포용력, 전략, 비전, 대범함")
