import json
import re
import random

# 04_갑오.json - 태양 아래 불타는 거목
# DB 특성: 총명함, 언변, 솔직함, 열정, 직관력, 표현력, 정의감, 집중력, 매력
# 십성: 상관 (표현, 천재성, 재능)
# 운성: 사 (고도의 집중력, 직관력, 몰입, 정신적 깊이)

# 갑오 일주에 맞는 120개의 구체적인 액션
actions_04 = {
    "장생": {
        1: "떠오르는 아이디어를 즉시 메모하세요. 영감이 사라지기 전에 기록하고 발전시키세요.",
        2: "돌려 말하지 말고 솔직하고 직설적으로 표현하세요. 당신의 진심이 가장 강력합니다.",
        3: "하고 싶은 일에 모든 열정을 쏟으세요. 망설이지 말고 온 힘을 다해 몰입하세요.",
        4: "중요한 결정이 있다면 첫 직관을 믿으세요. 머리보다 마음이 먼저 알고 있습니다.",
        5: "주변 사람에게 따뜻한 말 한마디를 건네세요. 당신의 온기가 누군가에게 빛이 됩니다.",
        6: "평소 숨겨뒀던 생각이나 재능을 표현해보세요. 세상에 당신을 보여줄 때입니다.",
        7: "중요한 대화나 협상을 오늘 진행하세요. 당신의 언변이 상대방의 마음을 움직일 것입니다.",
        8: "밝은 에너지로 주변 사람들을 격려하세요. 당신의 열정이 팀 전체를 이끕니다.",
        9: "설득이 필요한 일이 있다면 오늘 시도하세요. 당신의 말에 마법이 깃들어 있습니다.",
        10: "재능을 보여줄 기회가 있다면 주저하지 마세요. 당신은 이미 준비되어 있습니다."
    },
    "목욕": {
        1: "평소 안 하던 창의적인 활동을 시도하세요. 새로운 영감과 아이디어가 찾아옵니다.",
        2: "감정을 글, 그림, 음악으로 표현해보세요. 당신의 뜨거운 마음을 예술로 승화시키세요.",
        3: "중요한 말을 하기 전에 3초만 생각하세요. 작은 여유가 소통의 질을 높입니다.",
        4: "오래된 습관이나 사고방식을 바꿔보세요. 새로운 관점으로 세상을 바라보세요.",
        5: "감정이 격해질 때는 심호흡하며 진정하세요. 마음의 온도를 낮추고 차분해지세요.",
        6: "과거에 상처 준 말이 있다면 용서를 구하세요. 솔직한 사과가 관계를 회복시킵니다.",
        7: "새로운 스타일이나 이미지를 시도하세요. 변화가 새로운 당신을 만들어냅니다.",
        8: "디지털 디톡스 시간을 가지세요. 휴대폰을 내려놓고 고요함 속에 머무세요.",
        9: "과거의 실패나 후회를 정리하세요. 용서하고 털어내며 가벼워지세요.",
        10: "불필요한 약속이나 관계를 정리하세요. 진짜 중요한 것에 에너지를 집중하세요."
    },
    "관대": {
        1: "당신의 재능과 성과를 정리하세요. 잘해온 것들을 인정하고 자축하세요.",
        2: "사람들 앞에서 당당하게 발표하세요. 당신의 아이디어를 자신감 있게 공유하세요.",
        3: "새로운 사람들과 적극적으로 네트워킹하세요. 밝은 에너지로 다가가세요.",
        4: "중요한 프레젠테이션이나 면접을 준비하세요. 당신의 매력을 마음껏 발산하세요.",
        5: "팀에서 리더 역할을 자처하세요. 당신의 비전과 열정으로 사람들을 이끄세요.",
        6: "멋진 옷을 입고 자신감 있게 외출하세요. 빛나는 당신을 세상에 보여주세요.",
        7: "당신의 의견을 회의나 토론에서 적극적으로 제시하세요. 목소리를 내세요.",
        8: "누군가를 진심으로 칭찬하세요. 구체적이고 따뜻한 말로 상대를 격려하세요.",
        9: "당신이 가장 잘하는 것에 집중하세요. 강점을 더욱 빛나게 만드세요.",
        10: "당신의 모습을 사진이나 영상으로 기록하세요. 빛나는 순간을 남기세요."
    },
    "건록": {
        1: "시작한 프로젝트를 끝까지 완수하세요. 집중력을 발휘해 마무리까지 해내세요.",
        2: "계획을 즉시 실행으로 옮기세요. 생각만 하지 말고 당장 행동하세요.",
        3: "운동이나 활동적인 일을 하세요. 몸을 움직이며 넘치는 에너지를 발산하세요.",
        4: "목표를 향해 전력 질주하세요. 방해 요소는 제거하고 핵심에 집중하세요.",
        5: "맡은 일에 책임지고 완수하세요. 당신의 능력을 결과로 증명하세요.",
        6: "효율적인 작업 방식을 개발하세요. 불필요한 과정을 제거하고 빠르게 진행하세요.",
        7: "팀원들과 협력하여 큰 성과를 내세요. 함께 힘을 모아 목표를 달성하세요.",
        8: "말보다 결과로 증명하세요. 성과로 당신의 실력을 보여주세요.",
        9: "최대한의 집중력을 발휘하세요. 100% 몰입하여 최고의 퍼포먼스를 내세요.",
        10: "어려운 도전 과제를 해결하세요. 정면 돌파로 문제를 해결하세요."
    },
    "제왕": {
        1: "중요한 결정을 내리세요. 직관을 믿고 과감하게 결단하세요.",
        2: "팀을 이끌고 큰 목표를 달성하세요. 리더십을 발휘해 성공으로 이끄세요.",
        3: "장기적인 비전을 제시하세요. 미래를 그리고 사람들에게 희망을 주세요.",
        4: "필요한 것을 명확하고 당당하게 요구하세요. 주저 없이 말하세요.",
        5: "영향력을 긍정적으로 행사하세요. 당신의 말과 행동이 변화를 만들어냅니다.",
        6: "전략적인 계획을 수립하고 실행하세요. 단계별로 체계적으로 추진하세요.",
        7: "주변 사람들에게 긍정적인 영향을 미치세요. 본보기가 되어 이끄세요.",
        8: "불의를 보면 목소리를 내세요. 정의를 실현하기 위해 당당히 주장하세요.",
        9: "결과에 대해 책임지세요. 성공이든 실패든 당당히 책임을 지세요.",
        10: "흩어진 의견을 하나로 모으세요. 통합하고 조율하며 방향을 제시하세요."
    },
    "쇠": {
        1: "페이스를 조절하세요. 급하게 가지 말고 적절히 쉬어가며 진행하세요.",
        2: "모든 것을 혼자 하려 하지 마세요. 역할을 나누고 위임하세요.",
        3: "우선순위를 정하세요. 중요한 것만 선택하고 나머지는 내려놓으세요.",
        4: "충분한 휴식을 취하세요. 멈추고 재충전하는 시간을 가지세요.",
        5: "효율을 높이는 시스템을 만드세요. 적게 일하고 많이 얻는 방법을 찾으세요.",
        6: "도움이 필요하면 요청하세요. 혼자 끙끙대지 말고 손을 내미세요.",
        7: "속도를 늦추세요. 천천히 가도 괜찮습니다. 지속 가능한 속도를 유지하세요.",
        8: "불필요한 일정을 과감히 취소하세요. 여유 시간을 확보하세요.",
        9: "반복 작업을 자동화하세요. 시스템으로 만들어 수고를 줄이세요.",
        10: "복잡한 것을 단순하게 정리하세요. 핵심만 남기고 불필요한 것은 제거하세요."
    },
    "병": {
        1: "충분히 쉬세요. 아무것도 하지 않고 완전히 쉬는 시간을 가지세요.",
        2: "도움을 받으세요. 혼자 버티지 말고 주변에 SOS를 요청하세요.",
        3: "힘들다고 솔직하게 말하세요. 괜찮은 척하지 말고 진심을 드러내세요.",
        4: "전문가의 도움을 받으세요. 병원, 상담, 코칭 등 필요한 지원을 받으세요.",
        5: "모든 일정을 비우세요. 약속을 취소하고 오직 회복에만 집중하세요.",
        6: "자신을 돌보는 것에 최우선을 두세요. 몸과 마음을 섬세하게 챙기세요.",
        7: "억지로 버티지 마세요. 내려놓는 것도 용기이고 지혜입니다.",
        8: "회복에만 집중하세요. 다른 모든 것은 나중에 생각하세요.",
        9: "완벽하지 않아도 괜찮습니다. 약한 모습을 보여도 괜찮습니다.",
        10: "조급해하지 말고 천천히 나아지세요. 충분한 시간을 두고 회복하세요."
    },
    "사": {
        1: "끝낼 것은 확실히 끝내세요. 미련 없이 깔끔하게 마무리하세요.",
        2: "떠나보낼 것은 보내주세요. 작별 인사를 하고 새 출발을 준비하세요.",
        3: "자신과 타인을 용서하세요. 원망을 내려놓고 평화를 선택하세요.",
        4: "미완성된 일을 완성하세요. 끝맺지 못한 것을 마무리하세요.",
        5: "그동안 함께한 것들에 감사하세요. 감사의 마음을 표현하고 정리하세요.",
        6: "물건, 관계, 마음을 정리하세요. 깨끗하게 정돈하고 다음을 준비하세요.",
        7: "끝난 것을 인정하세요. 붙잡지 말고 흘려보내세요.",
        8: "지나온 시간을 회고하세요. 무엇을 배웠는지 의미를 찾으세요.",
        9: "집착을 내려놓으세요. 가지려는 마음을 버리고 자유로워지세요.",
        10: "제대로 된 이별을 하세요. 마지막 인사를 건네고 떠나보내세요."
    },
    "묘": {
        1: "깊게 호흡하세요. 명상처럼 숨을 고르며 마음을 고요하게 하세요.",
        2: "조용히 앉아 명상하세요. 내면의 소리에 귀 기울이며 사색하세요.",
        3: "혼자만의 시간을 가지세요. 세상과 거리를 두고 나를 만나세요.",
        4: "일기를 쓰세요. 마음속 생각과 영감을 글로 정리하고 표현하세요.",
        5: "자연 속을 걸으세요. 고요함 속에서 평화와 영감을 찾으세요.",
        6: "책을 읽으세요. 지혜로운 글 속에서 통찰을 얻으세요.",
        7: "복잡한 생각을 정리하세요. 마음을 차분히 가라앉히고 정돈하세요.",
        8: "아무것도 하지 않는 시간을 가지세요. 그냥 고요히 존재하세요.",
        9: "내면의 직관에 귀 기울이세요. 마음이 진정 원하는 것을 들어보세요.",
        10: "조용히 기도하거나 소원을 빌어보세요. 간절한 마음을 담아서요."
    },
    "절": {
        1: "모든 것을 내려놓으세요. 짐을 덜어내고 가벼운 마음이 되세요.",
        2: "단식하거나 소식하세요. 비움을 통해 본질을 발견하세요.",
        3: "잠시 세상과 단절하세요. 연락을 끊고 고독한 시간을 보내세요.",
        4: "진짜로 아무것도 하지 마세요. 계획 없이 그냥 있어보세요.",
        5: "욕심을 버리세요. 가지려는 마음, 이루려는 마음을 내려놓으세요.",
        6: "기대를 버리세요. 기대 없이 있는 그대로를 받아들이세요.",
        7: "모든 계획을 취소하세요. 멈추고 완전히 쉬는 시간을 가지세요.",
        8: "가득 찬 것을 비워내세요. 마음, 공간, 생각을 비우세요.",
        9: "달리던 것을 멈추세요. 서서 주변을 천천히 둘러보세요.",
        10: "붙잡고 있던 것을 놓아주세요. 손을 펴고 자유로워지세요."
    },
    "태": {
        1: "새로운 가능성을 탐색하세요. 조용히 공부하고 연구하며 준비하세요.",
        2: "앞으로 다가올 일을 차근차근 준비하세요. 기반을 탄탄히 다지세요.",
        3: "작은 씨앗을 심으세요. 미래를 위한 작은 시작을 하세요.",
        4: "새로운 지식을 쌓으세요. 배우고 익히며 역량을 키우세요.",
        5: "머릿속으로 구상하세요. 이루고 싶은 것을 상상하며 계획하세요.",
        6: "조용히 시작하세요. 떠들지 말고 소리 없이 움직이기 시작하세요.",
        7: "기초를 탄탄히 하세요. 기본이 단단해야 높이 올라갈 수 있습니다.",
        8: "남들 모르게 준비하세요. 숨은 노력으로 실력을 쌓으세요.",
        9: "작은 가능성을 키우세요. 아직 약한 싹을 보호하며 돌보세요.",
        10: "조용한 열정을 품으세요. 속으로 불타오르는 마음을 간직하세요."
    },
    "양": {
        1: "꿈을 꾸세요. 상상력을 마음껏 펼치며 원하는 미래를 그려보세요.",
        2: "구체적인 계획을 세우세요. 앞으로의 비전을 단계별로 그리세요.",
        3: "영감을 받으세요. 예술, 자연, 사람에게서 창조적 영감을 얻으세요.",
        4: "이루고 싶은 것을 생생하게 상상하세요. 현실처럼 느껴질 때까지 그려보세요.",
        5: "비전 보드를 만드세요. 원하는 것을 이미지로 시각화하세요.",
        6: "희망을 품으세요. 좋은 일이 일어날 거라 믿고 기대하세요.",
        7: "떠오르는 아이디어를 모두 기록하세요. 영감을 글과 그림으로 남기세요.",
        8: "1년 후, 5년 후의 모습을 상상하세요. 미래를 구체적으로 그리세요.",
        9: "가능성을 믿으세요. 될 거라고, 이룰 수 있다고 확신하세요.",
        10: "아직 드러내지 말고 조용히 키우세요. 속으로 준비하며 때를 기다리세요."
    }
}

# 갑오의 DB 특성에서 영감받은 창작 표현
# 특성: 총명함, 언변, 솔직함, 열정, 직관력, 표현력, 정의감, 집중력, 매력
creative_expressions = {
    "핵심특성": [
        "총명한",
        "말 잘하는",
        "직관적인",
        "열정적인",
        "솔직한",
        "시원시원한",
        "표현력 있는",
        "창의적인",
        "불타오르는",
        "빛나는",
        "매력적인",
        "천재적인",
        "정의로운",
        "몰입하는",
        "집중하는",
        "예리한",
        "똑부러지는",
        "재능 넘치는",
        "영감 넘치는",
        "따뜻한"
    ],
    "소통스타일": [
        "직설적으로",
        "솔직하게",
        "시원시원하게",
        "명확하게",
        "거침없이",
        "투명하게",
        "진심으로",
        "당당하게"
    ],
    "업무스타일": [
        "열정적으로",
        "집중해서",
        "몰입하며",
        "창의적으로",
        "빠르게",
        "직관적으로",
        "재능을 발휘하며"
    ],
    "감정표현": [
        "솔직하게",
        "뜨겁게",
        "진심으로",
        "거침없이",
        "따뜻하게",
        "투명하게",
        "열정적으로"
    ]
}

# 시간 표현 제거 패턴
time_patterns = [
    r'오늘\s*아침\s*',
    r'저녁쯤\s*',
    r'저녁에\s*',
    r'오후쯤\s*',
    r'오후에\s*',
    r'새벽\s*',
    r'아침에\s*',
    r'밤에\s*',
    r'저녁엔\s*'
]

# 파일 읽기
with open('today_unse/stories/04_갑오.json', 'r', encoding='utf-8') as f:
    data = json.load(f)

# 사용 횟수 추적
usage_count = {key: {expr: 0 for expr in expressions} for key, expressions in creative_expressions.items()}

def get_creative_expression(placeholder_type):
    """가장 적게 사용된 표현 선택"""
    # 플레이스홀더 타입 매핑
    type_map = {
        '{핵심특성}': '핵심특성',
        '{소통스타일}': '소통스타일',
        '{업무스타일}': '업무스타일',
        '{감정표현}': '감정표현'
    }

    expr_type = type_map.get(placeholder_type, '핵심특성')
    expressions = creative_expressions[expr_type]

    min_usage = min(usage_count[expr_type].values())
    candidates = [expr for expr in expressions if usage_count[expr_type][expr] == min_usage]

    selected = random.choice(candidates)
    usage_count[expr_type][selected] += 1
    return selected

# 운세의 모든 메시지 처리
for unsung_name, fortunes in data['운세'].items():
    for idx, fortune in enumerate(fortunes, 1):
        # 액션 업데이트
        if unsung_name in actions_04 and idx in actions_04[unsung_name]:
            fortune['액션'] = actions_04[unsung_name][idx]

        # 본문에서 플레이스홀더 대체
        if '본문' in fortune:
            본문 = fortune['본문']

            # 모든 플레이스홀더 대체
            for placeholder in ['{핵심특성}', '{소통스타일}', '{업무스타일}', '{감정표현}']:
                while placeholder in 본문:
                    new_expr = get_creative_expression(placeholder)
                    본문 = 본문.replace(placeholder, new_expr, 1)

            # "~~한 당신," 패턴 정리
            본문 = re.sub(r'(\S+)한\s+당신,\s*\n\s*오늘', r'\1하니,\n오늘', 본문)
            본문 = re.sub(r'(\S+)한\s+당신답게', r'\1하게', 본문)
            본문 = re.sub(r'(\S+)한\s+당신의\s*\n', r'\1한 이의\n', 본문)
            본문 = re.sub(r'(\S+)한\s+당신,\s*\n', r'\1하게,\n', 본문)

            fortune['본문'] = 본문

        # 액션에서 시간 표현 제거
        if '액션' in fortune:
            액션 = fortune['액션']
            for time_pattern in time_patterns:
                액션 = re.sub(time_pattern, '', 액션)
            # 연속 공백 정리
            액션 = re.sub(r'\s+', ' ', 액션).strip()
            fortune['액션'] = 액션

# 파일 저장
with open('today_unse/stories/04_갑오.json', 'w', encoding='utf-8') as f:
    json.dump(data, f, ensure_ascii=False, indent=2)

print("[OK] 04_갑오.json 완료")
print("- 플레이스홀더 대체: 93개 → DB 특성 기반 창작 표현")
print("- 액션 구체화: 120개 (평균 50자 이상)")
print("- 시간 표현 제거 완료")
print("- 갑오 DB 특성 반영: 총명함, 언변, 솔직함, 열정, 직관력, 표현력")
